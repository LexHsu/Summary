Tcp vs Http vs Socket
===

### TCP (Transfer Control Protocol)

传输层协议，主要解决数据如何在网络中传输。对上层网络提供接口，使上层网络数据的传输建立在“无差别”的网络之上。
建立起一个TCP连接需要经过三次握手：

1. 客户端发送 SYN 包(SYN = j)到服务器，并进入 SYN_SEND 状态，等待服务器确认；
2. 服务器收到 SYN 包，必须确认客户的 SYN（ack=j+1），同时自己也发送一个 SYN 包（SYN = k），即 SYN + ACK 包，此时服务器进入 SYN_RECV 状态；
3. 客户端收到服务器的 SYN ＋ ACK 包，向服务器发送确认包 ACK(ack = k + 1)，此包发送完毕，客户端和服务器进入 ESTABLISHED 状态，完成三次握手。

握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP 是长连接，连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。
断开连接时服务器和客户端均可以主动发起断开 TCP 连接的请求，断开过程需要经过四次握手。

### HTTP (Hypertext Transfer Protocol)

1. 作为 Web 的基础协议，HTTP 是建立在 TCP 协议之上的应用层协议，主要解决如何包装应用数据。
2. HTTP 连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为一次连接。
3. HTTP 是无状态的协议。针对其无状态特性，在实际应用中又需要有状态的情况，通过 session/cookie 技术解决。
4. 在 HTTP 1.0 中，客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。
5. 在 HTTP 1.1 中，可在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。

由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是短连接，要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。
通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。
若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。
是基于 TCP/IP 协议基础之上的应用层协议，


### SOCKET

##### 概念

套接字（Socket）是通信的基石，是支持 TCP/IP 协议的网络通信的 API。Socket 接口包含网络通信必须的五种信息：

1. 连接使用的协议
2. 本地主机的IP地址
3. 本地进程的协议端口
4. 远地主机的IP地址
5. 远地进程的协议端口

应用层通过传输层进行数据通信时，TCP 会遇到同时为多个应用程序进程提供并发服务的问题。多个 TCP 连接或多个应用程序进程可能需要通过同一个 TCP 协议端口传输数据。
为了区别不同的应用程序进程和连接，许多计算机操作系统为应用程序与 TCP／IP 协议交互提供了套接字(Socket)接口。
应用层可以和传输层通过 Socket 接口，区分来自不同应用程序进程或网络连接的通信，实现数据传输的并发服务。

##### 建立 Socket 连接

建立 Socket 连接至少需要一对套接字：

1. 一个运行于客户端，称为 ClientSocket
2. 一个运行于服务端，称为 ServerSocket

套接字之间的连接过程分为三个步骤：

1. 服务器监听：服务器端套接字实时监控网络状态，监听客户端的连接请求。
2. 客户端请求：指客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。
3. 连接确认：当服务器端套接字监听到客户端套接字的连接请求时，就建立一个新的线程，把服务器端套接字的描述发给客户端，一旦客户端确认了此描述，双方就正式建立连接。
而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。

##### SOCKET 与 TCP 连接

创建 Socket 连接时，可以指定使用的传输层协议，Socket 可以支持不同的传输层协议（TCP 或 UDP），当使用 TCP 协议进行连接时，Socket是对 TCP/IP 协议的封装，通过调用 Socket，才能使用TCP/IP协议。

##### Socket 与 HTTP 连接

由于通常情况下 Socket 连接就是 TCP 连接，因此 Socket 连接一旦建立，通信双方即可开始相互发送数据内容，理论上客户端和服务器端一旦建立连接将不会主动断开此连接直到双方连接断开。
而很多情况下，服务器端需要主动向客户端推送数据，保持客户端与服务器数据的实时与同步。此时若双方建立的是 Socket 连接，服务器就可以直接将数据传送给客户端；
HTTP 连接使用的是“请求—响应”的方式，需要先建立连接，且客户端向服务器发出请求后，服务器端才能回复数据。因此，客户端定时向服务器端发送连接请求，不仅可以保持在线，同时也是在“询问”服务器是否有新的数据，如果有就将数据传给客户端。
