￼￼密钥交换算法-DH
===

对称加密算法提高数据安全性的同时带来了密钥管理的复杂性，消息收发双方若想发送加密消息，必须事先约定好加密算法并发放密钥。
而如何安全的传递密钥，成为对称加密算法的棘手问题。密钥交换算法，即 Diffie-Hellman 算法可解决该问题。DH加密算法为非对称加密算法，所谓非对称即加密与解密使用的密钥不同。

### 模型分析

以消息传递模型为例，甲方为发送者，乙方为接收者，分述甲乙双方如何构建密钥，交换密钥和加密数据。

首先，甲乙双方需要在收发信息前构建自己的密钥对，如下图：

![alt text](book/img/4.1.1-key.png)

甲乙两方构建密钥需要经过以下几个步骤：

1. 由消息发送的一方构建密钥，这里由甲方构建密钥。
2. 由构建密钥的一方向对方公布公钥，这里由甲方向乙方发布公钥。
3. 由消息接收的一方通过对方公钥构建自身密钥，这里由乙方使用甲方公钥构建乙方密钥。
4. 由消息接收的一方向对方公布其公钥，这里由乙方向甲方公布公钥。

注意，乙方构建自己的密钥对必须使用甲方公钥作为参数，否则无法确保甲乙双方获得同一个私密密钥，消息加密更无从谈起。
其次，假设甲乙双方事先约定好了用于数据加密的对称加密算法（如 AES 算法），并构建本地密钥（即对称加密算法中的密钥），
甲方需要使用自己的私钥和乙方的公钥才能构建本地密钥，即用于数据加解密操作的对称加密算法密钥。
同样，乙方需要使用自己的私钥和甲方的公钥构建本地密钥。如下图：

![alt text](book/img/4.1.2-key.png)

虽然甲乙双方使用了不同的密钥来构建本地密钥，但得到的密钥是一致的，正因为如此，甲乙双方才能顺利进行加密消息的传递。
最后，甲乙双方构建了本地密钥后，可按基于对称加密算法的消息传递模型完成消息传递，如下图：

![alt text](book/img/4.1.3-msg.png)

作为对称加密体制向非对称加密体制的一种过渡，DH 算法仅比一般对称加密算法多了密钥对的构建和本地密钥构建这两个步骤，
而真正的数据加解密操作仍由对称加密算法完成。

### 算法实现

Java 6 提供 DH 算法实现细节如下：

| 算法     | 密钥长度            | 密钥长度默认值  | 工作模式 | 填充方式 |    备注    |
|:-------:|:------------------:|:-------------:|:-------:|:------:|:---------:|
| DH      | 512~1024(64的倍数)  | 1024          | 无      | 无      | Java 6 实现|

本文约定所有非对称算法实现的公有方法均不使用 java.security 和 javax.crypto 包及其子包中的接口或类作为参数或返回值。
源码见附件。

### DH 算法安全

DH 算法安全强度在于密钥长度和对称加密算法的选择。

- DH 算法支持的密钥长度为 64 的倍数位，范围在 [512 ~ 1024] 之间，密钥长度与加密安全强度成正比，与运算时间成反比。
使用时需要选择合适的密钥长度。

- 对称加密算法可以选择 DES，DESede 和 AES 算法等。
