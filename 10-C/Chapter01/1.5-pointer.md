指针
===

### void 指针

`void*` 又被称为万能指针，可以代表任何对象的地址，但没有该对象的类型。也就是说必须转型后才能进行对象操作。`void*` 指针可与其他任何类型指针进行隐式转换。

```c
void test(void* p, size_t len) {
    unsigned char* cp = p;
    for (int i = 0; i < len; i++)
    {
        printf("%02x ", *(cp + i));
    }
    printf("\n");
}

int main() {
    int x = 0x00112233;
    test(&x, sizeof(x));
    return 0;
}

// Result:
33 22 11 00
```

### 初始化指针

可以用初始化器初始化指针。

1. 空指针常量 NULL。
2. 相同类型的指针，或者指向限定符较少的相同类型指针。
3. void 指针。

非自动周期指针变量或静态生存期指针变量必须用编译期常量表达式初始化，如函数名称等。

```c
char s[] = "abc";
char* sp = s;
int x = 5;
int* xp = &x;

void test() {}
typedef void(*test_t)();

int main(int argc, char* argv[]) {
    static int* sx = &x;
    static test_t t = test;
    return 0;
}
```

### 指针运算

- 对指针进行相等或不等运算来判断是否指向同一对象。

```c
int x = 1;
int *a, *b;
a = &x;
b = &x;
printf("%d\n", a == b);
```

- 对指针进行加法运算获取数组第 n 个元素指针。

```c
int x[] = { 1, 2, 3 };
int* p = x;
printf("%d, %d\n", x[1], *(p + 1));
```

- 对指针进行减法运算，以获取指针所在元素的数组索引序号。

```c
int x[] = { 1, 2, 3 };
int* p = x;
p++;
p++;
int index = p - x;
printf("x[%d] = %d\n", index, x[index]);

//Result:
x[2] = 3;
```

- 对指针进行大小比较运算，相当于判断数组索引序号大小。

```c
int x[] = { 1, 2, 3 };
int* p1 = x;
int* p2 = x;
p1++;
p2++;
p2++;
printf("p1 < p2? %s\n", p1 < p2 ? "Y" : "N");

// Result:
p1 < p2? Y
```

- 可直接用 `&x[i]` 获取指定序号元素的指针。

```c
int x[] = { 1, 2, 3 };
int* p = &x[1];
*p += 10;
printf("%d\n", x[1]);
// [] 优先级比 & 高，* 运算符优先级比算术运算符高。
```

### 限定符

限定符 const 可以声明 "类型为指针的常量" 和 "指向常量的指针" 。

```c
int x[] = { 1, 2, 3 };
// 指针常量: 指针本身为常量，不可修改，但可修改目标对象。
int* const p1 = x;
*(p1 + 1) = 22;
printf("%d\n", x[1]);
// 常量指针: 目标对象为常量，不可修改，但可修改指针。
int const *p2 = x;
p2++;
printf("%d\n", *p2);
```
区别在于 const 是修饰 p 还是 *p。
具有 restrict 限定符的指针被称为限定指针。告诉编译器在指针生存周期内，只能通过该指针修改对象，但编译器可自主决定是否采纳该建议。

### 数组指针

指向数组本身的指针，而非指向第一元素的指针。

```c
int x[] = { 1, 2, 3 };
int(*p)[] = &x;
for (int i = 0; i < 3; i++) {
    printf("x[%d] = %d\n", i, (*p)[i]);
    printf("x[%d] = %d\n", i, *(*p + i));
}
```
`&x` 返回数组指针，`*p` 获取和 x 相同的指针，也就是指向第一元素的指针，然后可以用下标或指针运算存储元素。

### 指针数组

元素是指针的数组，通常用于表示字符串数组或交错数组。数组元素是目标对象 (可以是数组或其他对象) 的指针，而非实际嵌入内容。

```c
int* x[3] = {};
x[0] = (int[]){ 1 };
x[1] = (int[]){ 2, 22 };
x[2] = (int[]){ 3, 33, 33 };
int* x1 = *(x + 1);
for (int i = 0; i < 2; i++) {
    printf("%d\n", x1[i]);
    printf("%d\n", *(*(x + 1) + i));
}

// Result:
2
2
22
22
```

指针数组 x 是三个指向目标对象(数组)的指针，`*(x + 1)` 获取目标对象，即 x[1]。
