AIDL(Android Interface Definition Language)
===

### 使用场景

1. 仅在 A 应用程序(客户端)访问 B 应用程序(服务端)来实现 IPC 通信，且在 A 多线程（或多客户端）访问 B 的情况下使用 AIDL。
2. 如果不需要使用进程间 IPC 通信，通过 Binder 接口实现更合适，
3. 如果需要实现进程间的 IPC 通信，但不需要处理多线程（多客户端），通过 Messager 接口实现更合适。


AIDL 接口的调用采用的是直接的函数调用方式，但无法预知哪个进程（或线程）将调用该接口。同进程的线程调用和其他进程调用该接口之间是有所区别的：

在同进程中调用 AIDL 接口，AIDL 接口代码的执行将在调用该 AIDL 接口的线程中完成，如果在主 UI 线程中调用 AIDL 接口，该调用将会在主 UI 线程中完成。

远程进程调用 AIDL 接口时，将会在 AIDL 所属的进程的线程池中分派一个线程来执行该 AIDL 代码，所以编写 AIDL 时，必须准备好可能有未知线程访问、同一时间可能有多个调用发生（多个线程的访问），所以 ADIL 接口的实现必须是线程安全的。

可以用关键字 oneway 来标明远程调用的行为属性，不会租塞远程线程的运行，那么远程调用将仅仅是调用所需的数据传输过来并立即返回，而不会等待结果的返回。
AIDL 接口将最终将获得一个从 Binder 线程池中产生的调用（和普通的远程调用类似）。如果关键字 oneway 在本地调用中被使用，将不会对函数调用有任何影响。

### 定义 AIDL 接口

AIDL 接口使用 java 语法编写，文件后缀名为 .aidl，该文件保存在 src/目录下。编译时，
Android sdk 工具将会为 src/目录下的 .aidl 文件在 gen/ 目录下产生一个 IBinder 接口。
被调用方必须相应的实现该IBinder接口。调用方可以绑定该服务、调用其中的方法实现 IPC 通信。

创建一个用AIDL实现的服务端，需要以下几个步骤：

1. 创建.aidl文件：该文件（YourInterface.aidl）定义了客户端可用的方法和数据的接口
2. 实现该接口：Android SDK 将会根据 .aidl 文件产生 AIDL 接口。生成的接口包含一个名为 Stub 的抽象内部类，该类声明了所有 .aidl 中描述的方法，在代码里继承该 Stub 类并且实现 .aidl 中定义的方法。
3.向客户端公开服务端的接口：实现一个Service，并且在 onBinder 方法中返回第 2 步中实现的 Stub 类的子类（实现类）。

注意：服务端 AIDL 的任何修改都必须的同步到所有的客户端，否则客户端调用服务端得接口可能会导致程序异常（因为此时客户端此时可能会调用到服务端已不再支持的接口）。
